var vis=function(t){"use strict";function e(t,e){const n={};return e.forEach(function(t){n[t.StageCode]=t}),t.map(t=>t.Pathway).map(t=>{let e=!1;t=t.map(function(t){t=Object.assign({},t);const r=n[t.Stage];return t.Colour=r.Colour,e?(t.PreTre=!1,t.PostTre=!0):r.PreTre?r.PostTre?(e=!0,t.PostTre=!0,t.PreTre=!0):(t.PreTre=!0,t.PostTre=!1):(t.PreTre=!1,t.PostTre=!0),t.Stage=r.Stage,t});let r,o=t[0],u=[o];for(let e=1;e<t.length;e++)r=t[e],r.Stage!==o.Stage&&(o=r,u.push(o));return u}).map((t,e)=>{const n=t[0].Time,r=t.length,o=t.filter(t=>t.PreTre),u=t.filter(t=>t.PostTre);let a,c=[],i=t[0];for(let o=1;o<r;o++)a=t[o],c.push({Index:e,Stage:i.Stage,Next:a.Stage,Colour:i.Colour,PreTre:i.PreTre,PostTre:i.PostTre,T0:i.Time,T1:a.Time,t0:i.Time-n,t1:a.Time-n,dt:a.Time-i.Time}),i=a;return c.push({Index:e,Stage:i.Stage,Colour:i.Colour,PreTre:i.PreTre,T0:i.Time,T1:1/0,t0:i.Time-n,t1:1/0,dt:1}),{Pattern:t.map(t=>t.Stage).join(":"),Num:c.length,PreTrePattern:o.map(t=>t.Stage).join(":"),PostTrePattern:u.map(t=>t.Stage).join(":"),NumPreTre:o.length,NumPostTre:u.length,Blocks:c}})}function n(t){return t.map(t=>{const e=t.NumPreTre;return{Pattern:t.PreTrePattern,Num:e,Blocks:t.Blocks.filter((t,n)=>n<e)}})}function r(t){return t.map(t=>{const e=t.Blocks.length,n=t.NumPostTre;return{Pattern:t.PostTrePattern,Num:n,Blocks:t.Blocks.filter((t,r)=>r>=e-n)}})}function o(t){let e=d3.nest().key(t=>t.Pattern).entries(t).sort((t,e)=>t.values.length-e.values.length),n=0;return e.map(t=>{return t.values.forEach(t=>{t.y0=n,n++}),t}).map(t=>{const e=t.values[0].Num,n=t.values.length;let r=[],o=0,u=t.values[0].y0,a=0;for(let c=0;c<e;c++){let i=t.values.map(t=>t.Blocks[c]),f=d3.sum(i.map(t=>t.dt));r.push({Stage:i[0].Stage,Colour:i[0].Colour,dt:f,x0_e:a/n,dx_e:f/n,y0:u,dy:n}),c<e-1&&(o+=f),a+=f}return o/=n,r.forEach(t=>t.dx_s=t.dx_e/o),r.forEach(t=>t.x0_s=t.x0_e/o),r[r.length-1].dx_e=1,0===o&&(r[r.length-1].x0_e=0),r[r.length-1].x0_s=1,r[r.length-1].dx_s=.02,r}).reduce((t,e)=>t.concat(e),[])}function u(t,e,n,r){n=n||365,r=r||5;const o={};e.forEach(function(t){o[t.Stage]=0}),t=t.map(t=>{return t=Object.assign({},t),t.at=function(t){let e;for(let n=0;n<this.Blocks.length;n++)if(e=this.Blocks[n],e.t1>=t&&e.t0<=t)return e.Stage;return e.Stage},t});let u,a=[];for(let e=0;e<=n;e+=r)u=Object.assign({},o),t.forEach(t=>u[t.at(e)]+=1),a.push(u);let c=e.map(t=>t.Stage).filter((t,e,n)=>n.indexOf(t)===e).reverse(),i={};return e.forEach(t=>i[t.Stage]=t.Colour),a.map((t,e)=>{let n=0;return c.filter(e=>t[e]>0).map(o=>{let u=t[o],a={Stage:o,x0:e*r,dx:r,y0:n,dy:u,Colour:i[o]};return n+=u,a})}).reduce((t,e)=>t.concat(e),[])}return t.filterPostPat=r,t.filterPrePat=n,t.toBlocks=e,t.toPatFreq=o,t.toStageDist=u,t}({});